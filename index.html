<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  
  
  <title>XML5 Standard</title>
  
  
  <link href="https://www.whatwg.org/style/specification" rel="stylesheet">
  
  
  <link href="https://resources.whatwg.org/bikeshed.css" rel="stylesheet">
  
  
  <link href="https://resources.whatwg.org/logo.svg" rel="icon">
  

  <meta content="Bikeshed 1.0.0" name="generator">
  <style type="text/css">
  switch { padding-left: 2em; }
  switch dt {text-indent: -1.5em; }
  switch dt:before {content: '\21AA'; padding: 0 0.5em 0 0; display: inline-block;}
  .non-print { background-color: #BFBFBF;  border-radius: 0.2em;}
</style>
  


 </head>
 <body class="h-entry status-LS">

  <div class="head">
  
   <p data-fill-with="logo"><a class="logo" href="https://whatwg.org/">
    <img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo.svg">
</a>
</p>
  
   <h1 class="p-name no-ref allcaps" id="title">XML5</h1>
  
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Standard — Last Updated
    <time class="dt-updated" datetime="2015-04-11">11 April 2015</time></span></h2>
  
   <div data-fill-with="spec-metadata">
    <dl>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:<annevk@annevk.nl>">Anne van Kesteren</a> (<span class="p-org org">Mozilla</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:<daniel.fath7@gmail.com>">Daniel Fath</a> (<span class="p-org org">Unaffiliated</span>)
    </dl>
   </div>
  
   <div data-fill-with="warning"></div>
</div>
  


  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  

  <div class="p-summary" data-fill-with="abstract">
   <p>XML with well-defined error handling.</p>

</div>
  

  <div data-fill-with="at-risk"></div>
  


  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
  

  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li><a href="#parsing"><span class="secno">1</span> <span class="content">Parsing XML documents</span></a>
     <ul class="toc">
      <li><a href="#parsing-overview"><span class="secno">1.1</span> <span class="content">Overview</span></a>
      <li><a href="#input-stream"><span class="secno">1.2</span> <span class="content">Input stream</span></a>
      <li><a href="#tokenization-overview"><span class="secno">1.3</span> <span class="content"><span>Tokenization</span></span></a>
       <ul class="toc">
        <li><a href="#data-head"><span class="secno">1.3.1</span> <span class="content"><span>Data state</span></span></a>
        <li><a href="#charref-data-head"><span class="secno">1.3.2</span> <span class="content"><span>Character reference in data state</span></span></a>
        <li><a href="#tag-head"><span class="secno">1.3.3</span> <span class="content"><span>Tag state</span></span></a>
        <li><a href="#end-tag-head"><span class="secno">1.3.4</span> <span class="content"><span>End tag state</span></span></a>
        <li><a href="#end-tag-name-head"><span class="secno">1.3.5</span> <span class="content"><span>End tag name state</span></span></a>
        <li><a href="#end-tag-after-head"><span class="secno">1.3.6</span> <span class="content"><span>End tag name after state</span></span></a>
        <li><a href="#pi-head"><span class="secno">1.3.7</span> <span class="content"><span>Pi state</span></span></a>
        <li><a href="#pi-target-head"><span class="secno">1.3.8</span> <span class="content"><span>Pi target state</span></span></a>
        <li><a href="#pi-target-after-head"><span class="secno">1.3.9</span> <span class="content"><span>Pi target after state</span></span></a>
        <li><a href="#pi-data-head"><span class="secno">1.3.10</span> <span class="content"><span>Pi data state</span></span></a>
        <li><a href="#pi-after-head"><span class="secno">1.3.11</span> <span class="content"><span>Pi after state</span></span></a>
        <li><a href="#markup-decl"><span class="secno">1.3.12</span> <span class="content"><span>Markup declaration state</span></span></a>
        <li><a href="#comment-head"><span class="secno">1.3.13</span> <span class="content"><span>Comment state</span></span></a>
        <li><a href="#comment-dash-head"><span class="secno">1.3.14</span> <span class="content"><span>Comment dash state</span></span></a>
        <li><a href="#comment-end-head"><span class="secno">1.3.15</span> <span class="content"><span>Comment end state</span></span></a>
        <li><a href="#cdata-head"><span class="secno">1.3.16</span> <span class="content"><span>CDATA state</span></span></a>
        <li><a href="#cdata-bracket-head"><span class="secno">1.3.17</span> <span class="content"><span>CDATA bracket state</span></span></a>
        <li><a href="#cdata-end-head"><span class="secno">1.3.18</span> <span class="content"><span>CDATA end state</span></span></a>
        <li><a href="#tag-name-head"><span class="secno">1.3.19</span> <span class="content"><span>Tag name state</span></span></a>
        <li><a href="#empty-tag-head"><span class="secno">1.3.20</span> <span class="content"><span>Empty tag state</span></span></a>
        <li><a href="#tag-attr-name-before-head"><span class="secno">1.3.21</span> <span class="content"><span>Tag attribute name before state</span></span></a>
        <li><a href="#tag-attr-name-head"><span class="secno">1.3.22</span> <span class="content"><span>Tag attribute name state</span></span></a>
        <li><a href="#tag-attr-name-after-head"><span class="secno">1.3.23</span> <span class="content"><span>Tag attribute name after state</span></span></a>
        <li><a href="#tag-attr-value-before-head"><span class="secno">1.3.24</span> <span class="content"><span>Tag attribute value before state</span></span></a>
        <li><a href="#tag-attr-value-dquote-head"><span class="secno">1.3.25</span> <span class="content"><span>Tag attribute value double quoted state</span></span></a>
        <li><a href="#tag-attr-value-squote-head"><span class="secno">1.3.26</span> <span class="content"><span>Tag attribute value single quoted state</span></span></a>
        <li><a href="#tag-attr-value-unquote-head"><span class="secno">1.3.27</span> <span class="content"><span>Tag attribute value unquoted state</span></span></a>
        <li><a href="#charref-attr-head"><span class="secno">1.3.28</span> <span class="content"><span>Character reference in attribute value state</span></span></a>
        <li><a href="#bogus-comment-head"><span class="secno">1.3.29</span> <span class="content"><span>Bogus comment state</span></span></a>
        <li><a href="#charref-tokenizer-head"><span class="secno">1.3.30</span> <span class="content"><span>Tokenizing character references</span></span></a>
        <li><a href="#doctype-head"><span class="secno">1.3.31</span> <span class="content"><span>DOCTYPE state</span></span></a>
       </ul>
      <li><a href="#tree-construction"><span class="secno">1.4</span> <span class="content">Tree construction</span></a>
     </ul>
    <li><a href="#writing"><span class="secno">2</span> <span class="content">Writing XML documents</span></a>
    <li><a href="#idioms"><span class="secno">3</span> <span class="content">Common parser idioms</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
    <li><a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ul>
    <li><a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ul>
   </ul></div>
  

  <main>


   <h2 class="heading settled" data-level="1" id="parsing"><span class="secno">1. </span><span class="content">Parsing XML documents</span><a class="self-link" href="#parsing"></a></h2>


   <p>This section and its subsection define the <dfn data-dfn-type="dfn" data-noexport="" id="xml-parser">XML parser<a class="self-link" href="#xml-parser"></a></dfn>.</p>


   <p>This specification defines the parsing rules for XML documents, whether they are syntactically correct or not. Certain points in the parsing algorithm are said to be <dfn data-dfn-type="dfn" data-lt="parse error" data-noexport="" id="parse-error">parse errors<a class="self-link" href="#parse-error"></a></dfn>. The handling for parse errors is well-defined: user agents must either act as described below when encountering such problems, or must terminate processing at the first error that they encounter for which they do not wish to apply the rules described below.</p>


   <h3 class="heading settled" data-level="1.1" id="parsing-overview"><span class="secno">1.1. </span><span class="content">Overview</span><a class="self-link" href="#parsing-overview"></a></h3>


   <p>The input to the XML parsing process consists of a stream of octets which is converted to a stream of code points, which in turn are tokenized, and finally those tokens are used to construct a tree.</p>


   <h3 class="heading settled" data-level="1.2" id="input-stream"><span class="secno">1.2. </span><span class="content">Input stream</span><a class="self-link" href="#input-stream"></a></h3>


   <p>The stream of Unicode characters that consists the input to the tokenization stage will be initially seen by the user agent as a stream of octets (typically coming over the network or from the local file system). The octets encode Unicode code points according to a particular encoding, which the user agent must use to decode the octets into code points.</p>


   <p class="warning">Define how to find the encoding</p>

   <p class="warning">Decide how to deal with null values</p>



   <h3 class="heading settled" data-level="1.3" id="tokenization-overview"><span class="secno">1.3. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tokenization">Tokenization<a class="self-link" href="#tokenization"></a></dfn></span><a class="self-link" href="#tokenization-overview"></a></h3>


   <p class="warning">Decide how to deal with namespaces</p>


   <dl>
  
    <h4 class="heading settled" data-level="1.3.1" id="data-head"><span class="secno">1.3.1. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="data-state">Data state<a class="self-link" href="#data-state"></a></dfn></span><a class="self-link" href="#data-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>)
      
      <dd>Switch to <a data-link-type="dfn" href="#character-reference-in-data-state">character reference in data state</a>.
      

      
      <dt>U+003C LESSER-THAN SIGN (<code>&lt;</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-state">tag state</a>.
      

      
      <dt>EOF
      
      
      <dd>Emit an end-of-file token.
      

      
      <dt>Anything else
      
      
      <dd>Emit the input character as character. Stay in this state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.2" id="charref-data-head"><span class="secno">1.3.2. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="character-reference-in-data-state">Character reference in data state<a class="self-link" href="#character-reference-in-data-state"></a></dfn></span><a class="self-link" href="#charref-data-head"></a></h4>

  
    <dd>
    Switch to the <a data-link-type="dfn" href="#data-state">data state</a>.


     <p>Attempt to <a data-link-type="dfn" href="#consume-a-character-reference">consume a character reference</a>.</p>
     


     <p>If nothing is returned emit a U+0026 AMPERSAND character (&amp;) token.</p>
     


     <p>Otherwise, emit character tokens that were returned.</p>
     
  

  
    <h4 class="heading settled" data-level="1.3.3" id="tag-head"><span class="secno">1.3.3. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-state">Tag state<a class="self-link" href="#tag-state"></a></dfn></span><a class="self-link" href="#tag-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+002F SOLIDUS (<code>/</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#end-tag-state">end tag state</a>.
      

      
      <dt>U+003F QUESTION MARK(<code>?</code>)
      

      
      <dd>Switch to the <a data-link-type="dfn" href="#pi-state">pi state</a>.
      

      
      <dt>U+0021 (<code>!</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#markup-declaration-state">markup declaration state</a>.
      

      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dt>U+003A (<code>:</code>)
      
      
      <dt>U+003C LESSER-THAN SIGN (<code>&lt;</code>)
      
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dt>EOF
      

      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit a U+003C LESSER-THAN SIGN (<code>&lt;</code>) character.
      Reconsume the current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      

      
      <dd>Create a new tag token and set its name to the input character, then
         switch to the <a data-link-type="dfn" href="#tag-name-state">tag name state</a>.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.4" id="end-tag-head"><span class="secno">1.3.4. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="end-tag-state">End tag state<a class="self-link" href="#end-tag-state"></a></dfn></span><a class="self-link" href="#end-tag-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
  
     <dl class="switch">
  
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      

  
      <dd>Emit a short end tag token and then switch to the <a data-link-type="dfn" href="#data-state">data
  state</a>.
      
  
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
  
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
  
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
  
      <dt>U+003C LESSER-THAN SIGN (<code>&lt;</code>)
      
  
      <dt>U+003A (<code>:</code>)
      
  
      <dt>EOF
      

  
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit a U+003C LESSER-THAN SIGN (<code>&lt;</code>) character
   token and a U+002F SOLIDUS (<code>/</code>) character token. Reconsume the current
   input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

  
      <dt>Anything else
      

  
      <dd>Create an end tag token and set its name to the input character, then
   switch to the <a data-link-type="dfn" href="#end-tag-name-state">end tag name state</a>.
      
  
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.5" id="end-tag-name-head"><span class="secno">1.3.5. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="end-tag-name-state">End tag name state<a class="self-link" href="#end-tag-name-state"></a></dfn></span><a class="self-link" href="#end-tag-name-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#end-tag-name-after-state">end tag name after state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
       current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data
      state</a>.
      
      
      <dt>Anything else
      
      
      <dd>Append  the current input character to the tag name and stay in the
      current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.6" id="end-tag-after-head"><span class="secno">1.3.6. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="end-tag-name-after-state">End tag name after state<a class="self-link" href="#end-tag-name-after-state"></a></dfn></span><a class="self-link" href="#end-tag-after-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Stay in the current state.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Stay in the current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.7" id="pi-head"><span class="secno">1.3.7. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="pi-state">Pi state<a class="self-link" href="#pi-state"></a></dfn></span><a class="self-link" href="#pi-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the current input character in the
      <a data-link-type="dfn" href="#bogus-comment-state">bogus comment state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Create a new processing instruction token. Set target to the current
     input character and data to the empty string. Then switch to the <a data-link-type="dfn" href="#pi-target-state">pi
     target state</a>.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.8" id="pi-target-head"><span class="secno">1.3.8. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="pi-target-state">Pi target state<a class="self-link" href="#pi-target-state"></a></dfn></span><a class="self-link" href="#pi-target-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#pi-target-after-state">pi target after state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+003F QUESTION MARK(<code>?</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#pi-after-state">pi after state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the current input character to the processing instruction target and stay in the
      current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.9" id="pi-target-after-head"><span class="secno">1.3.9. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="pi-target-after-state">Pi target after state<a class="self-link" href="#pi-target-after-state"></a></dfn></span><a class="self-link" href="#pi-target-after-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Stay in the current state.
      

      
      <dt>Anything else
      
      
      <dd>Reprocess the current input character in the <a data-link-type="dfn" href="#pi-data-state">pi data
     state</a>.
      
    
     </dl>
     
   

  
    <h4 class="heading settled" data-level="1.3.10" id="pi-data-head"><span class="secno">1.3.10. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="pi-data-state">Pi data state<a class="self-link" href="#pi-data-state"></a></dfn></span><a class="self-link" href="#pi-data-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+003F QUESTION MARK(<code>?</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#pi-after-state">pi after state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the current input character to the pi’s data and stay in the
     current state.
      
    
     </dl>
     
   

  
    <h4 class="heading settled" data-level="1.3.11" id="pi-after-head"><span class="secno">1.3.11. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="pi-after-state">Pi after state<a class="self-link" href="#pi-after-state"></a></dfn></span><a class="self-link" href="#pi-after-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     
    
     <dl class="switch">
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+003F QUESTION MARK(<code>?</code>)
      
      
      <dd>Append the current input character to the pi’s data and stay in the
     current state.
      

      
      <dt>Anything else
      
      
      <dd>Reprocess the current input character in the <a data-link-type="dfn" href="#pi-data-state">pi data
     state</a>.
      
    
     </dl>
     
   

  
    <h4 class="heading settled" data-level="1.3.12" id="markup-decl"><span class="secno">1.3.12. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="markup-declaration-state">Markup declaration state<a class="self-link" href="#markup-declaration-state"></a></dfn></span><a class="self-link" href="#markup-decl"></a></h4>

  
    <dd>
    If the next two characters are both U+002D (<code>-</code>)
    characters, consume those two characters, create a comment token whose data
    is the empty string and then switch to the <a data-link-type="dfn" href="#comment-state">comment state</a>.


     <p>Otherwise, if the next seven characters are an exact match for
    "[CDATA[", then consume those characters and switch to the <a data-link-type="dfn" href="#cdata-state">CDATA
    state</a>.</p>
     


     <p>Otherwise, if the next seven characters are an exact match for "DOCTYPE",
    then this is a <a data-link-type="dfn" href="#parse-error">parse error</a>. Consume those characters and switch
    to the <a data-link-type="dfn" href="#doctype-state">DOCTYPE state</a>.</p>
     
    


     <p>Otherwise, this is a <a data-link-type="dfn" href="#parse-error">parse error</a>. Switch to the <a data-link-type="dfn" href="#bogus-comment-state">bogus
    comment state</a>.</p>
     
  

  
    <h4 class="heading settled" data-level="1.3.13" id="comment-head"><span class="secno">1.3.13. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="comment-state">Comment state<a class="self-link" href="#comment-state"></a></dfn></span><a class="self-link" href="#comment-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+002D HYPHEN-MINUS, (<code>-</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#comment-dash-state">comment dash state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the comment token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the current character to the comment data.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.14" id="comment-dash-head"><span class="secno">1.3.14. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="comment-dash-state">Comment dash state<a class="self-link" href="#comment-dash-state"></a></dfn></span><a class="self-link" href="#comment-dash-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+002D HYPHEN-MINUS, (<code>-</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#comment-end-state">comment end state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the comment token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append a U+002D (<code>-</code>) and the current input character to the
     comment token’s data. Stay in the current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.15" id="comment-end-head"><span class="secno">1.3.15. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="comment-end-state">Comment end state<a class="self-link" href="#comment-end-state"></a></dfn></span><a class="self-link" href="#comment-end-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the comment token. Switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+002D HYPHEN-MINUS, (<code>-</code>)
      
      
      <dd>Append the current input character to the comment token’s data. Stay in
     the current state.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the comment token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append two U+002D (<code>-</code>) characters and the current input
     character to the comment token’s data. Switch to the <a data-link-type="dfn" href="#comment-state">comment
     state</a>.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.16" id="cdata-head"><span class="secno">1.3.16. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="cdata-state">CDATA state<a class="self-link" href="#cdata-state"></a></dfn></span><a class="self-link" href="#cdata-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+005D RIGHT SQUARE BRACKET (<code>]</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#cdata-bracket-state">CDATA bracket state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the current input character in the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Emit the current input character as character token. Stay in the
     current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.17" id="cdata-bracket-head"><span class="secno">1.3.17. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="cdata-bracket-state">CDATA bracket state<a class="self-link" href="#cdata-bracket-state"></a></dfn></span><a class="self-link" href="#cdata-bracket-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+005D RIGHT SQUARE BRACKET (<code>]</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#cdata-end-state">CDATA end state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the current input character in the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Emit a U+005D RIGHT SQUARE BRACKET (<code>]</code>) character as character token and also
     emit the current input character as character token. Stay in the current
     state.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.18" id="cdata-end-head"><span class="secno">1.3.18. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="cdata-end-state">CDATA end state<a class="self-link" href="#cdata-end-state"></a></dfn></span><a class="self-link" href="#cdata-end-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+005D RIGHT SQUARE BRACKET (<code>]</code>)
      
      
      <dd>Emit the current input character as character token. Stay in the
     current state.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reconsume the current input character in the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Emit two U+005D RIGHT SQUARE BRACKET (<code>]</code>) characters as character tokens and
     also emit the current input character as character token. Switch to the
      <a data-link-type="dfn" href="#cdata-state">CDATA state</a>.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.19" id="tag-name-head"><span class="secno">1.3.19. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-name-state">Tag name state<a class="self-link" href="#tag-name-state"></a></dfn></span><a class="self-link" href="#tag-name-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-name-before-state">tag attribute name before state</a>.
      

      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+002F SOLIDUS (<code>/</code>)
      
      
      <dd>Set current tag to empty tag. Switch to the <a data-link-type="dfn" href="#empty-tag-state">empty tag state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append  the current input character to the tag name and stay in the
     current state.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.20" id="empty-tag-head"><span class="secno">1.3.20. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="empty-tag-state">Empty tag state<a class="self-link" href="#empty-tag-state"></a></dfn></span><a class="self-link" href="#empty-tag-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current tag token as empty tag token and then switch to the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the current input character in the
      <a data-link-type="dfn" href="#tag-attribute-name-before-state">tag attribute name before state</a>.
      
    
     </dl>
     
   


  
    <h4 class="heading settled" data-level="1.3.21" id="tag-attr-name-before-head"><span class="secno">1.3.21. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-name-before-state">Tag attribute name before state<a class="self-link" href="#tag-attribute-name-before-state"></a></dfn></span><a class="self-link" href="#tag-attr-name-before-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      

      
      <dd>Stay in the current state.
      

      
      <dt>U+003E GREATER-THAN SIGN(<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+002F SOLIDUS (<code>/</code>)
      
      
      <dd>Set current tag to empty tag. Switch to the <a data-link-type="dfn" href="#empty-tag-state">empty tag state</a>.
      

      
      <dt>U+003A COLON (<code>:</code>)
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Stay in the current state.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Start a new attribute in the current tag token. Set that attribute’s
     name to the current input character and its value to the empty string and
     then switch to the <a data-link-type="dfn" href="#tag-attribute-name-state">tag attribute name state</a>.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.22" id="tag-attr-name-head"><span class="secno">1.3.22. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-name-state">Tag attribute name state<a class="self-link" href="#tag-attribute-name-state"></a></dfn></span><a class="self-link" href="#tag-attr-name-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+003D EQUALS SIGN (<code>=</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-value-before-state">tag attribute value before state</a>.
      

      
      <dt>U+003E GREATER-THEN SIGN (<code>></code>)
      
      
      <dd>Emit the current token as start tag token. Switch to the <a data-link-type="dfn" href="#data-state">data
     state</a>.
      

      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-name-after-state">tag attribute name after state</a>.
      

      
      <dt>U+002F SOLIDUS (<code>/</code>)
      
      
      <dd>Set current tag to empty tag. Switch to the <a data-link-type="dfn" href="#empty-tag-state">empty tag state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token as start tag token and
     then reprocess the current input character in the <a data-link-type="dfn" href="#data-state">data
     state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the current input character to the current attribute’s name.
     Stay in the current state.
      
    
     </dl>
     


     <p>When the user agent leaves this state (and before emitting the tag token,
    if appropriate), the complete attribute’s name <em class="ct">must</em> be
    compared to the other attributes on the same token; if there is already an
    attribute on the token with the exact same name, then this is a parse error
    and the new attribute <em class="ct">must</em> be dropped, along with the
    value that gets associated with it (if any).</p>
     

  


  
    <h4 class="heading settled" data-level="1.3.23" id="tag-attr-name-after-head"><span class="secno">1.3.23. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-name-after-state">Tag attribute name after state<a class="self-link" href="#tag-attribute-name-after-state"></a></dfn></span><a class="self-link" href="#tag-attr-name-after-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Stay in the current state.
      

      
      <dt>U+003D EQUALS SIGN(<code>=</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-value-before-state">tag attribute value before state</a>.
      

      
      <dt>U+003E GREATER-THEN SIGN(<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>U+002F SOLIDUS (<code>/</code>)
      
      
      <dd>Set current tag to empty tag. Switch to the <a data-link-type="dfn" href="#empty-tag-state">empty tag state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Start a new attribute in the current tag token. Set that attribute’s
     name to the current input character and its value to the empty string and
     then switch to the <a data-link-type="dfn" href="#tag-attribute-name-state">tag attribute name state</a>.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.24" id="tag-attr-value-before-head"><span class="secno">1.3.24. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-value-before-state">Tag attribute value before state<a class="self-link" href="#tag-attribute-value-before-state"></a></dfn></span><a class="self-link" href="#tag-attr-value-before-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Stay in the current state.
      

      
      <dt>U+0022 QUOTATION MARK (<code>"</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-value-double-quoted-state">tag attribute value double quoted state</a>.
      

      
      <dt>U+0027 APOSTROPHE (<code>'</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-value-single-quoted-state">tag attribute value single quoted state</a>.
      

      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>):
      
      <dd>Reprocess the input character in the <a data-link-type="dfn" href="#tag-attribute-value-unquoted-state">tag attribute value unquoted
     state</a>.
      

      
      <dt>U+003E GREATER-THAN SIGN(<code>></code>)
      
      
      <dd>Emit the current token and then switch to the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the current input character to the current attribute’s value and
     then switch to the <a data-link-type="dfn" href="#tag-attribute-value-unquoted-state">tag attribute value unquoted state</a>.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.25" id="tag-attr-value-dquote-head"><span class="secno">1.3.25. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-value-double-quoted-state">Tag attribute value double quoted state<a class="self-link" href="#tag-attribute-value-double-quoted-state"></a></dfn></span><a class="self-link" href="#tag-attr-value-dquote-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0022 QUOTATION MARK (<code>"</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-name-before-state">tag attribute name before state</a>.
      

      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>)
      
      
      <dd>Switch to <a data-link-type="dfn" href="#character-reference-in-attribute-value-state">character reference in attribute value state</a>, with the
        <a data-link-type="dfn" href="#additional-allowed-character">additional allowed character</a> being U+0022 QUOTATION MARK(<code>"</code>).
      
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the input character to the current attribute’s value. Stay in
     the current state.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.26" id="tag-attr-value-squote-head"><span class="secno">1.3.26. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-value-single-quoted-state">Tag attribute value single quoted state<a class="self-link" href="#tag-attribute-value-single-quoted-state"></a></dfn></span><a class="self-link" href="#tag-attr-value-squote-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

    
     <dl class="switch">
      
      <dt>U+0022 APOSTROPHE (<code>'</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-name-before-state">tag attribute name before state</a>.
      

      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>)
      
      
      <dd>Switch to <a data-link-type="dfn" href="#character-reference-in-attribute-value-state">character reference in attribute value state</a>, with the
        <a data-link-type="dfn" href="#additional-allowed-character">additional allowed character</a> being APOSTROPHE (<code>'</code>).
      
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token and then reprocess the
     current input character in the <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the input character to the current attribute’s value. Stay in
     the current state.
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.27" id="tag-attr-value-unquote-head"><span class="secno">1.3.27. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tag-attribute-value-unquoted-state">Tag attribute value unquoted state<a class="self-link" href="#tag-attribute-value-unquoted-state"></a></dfn></span><a class="self-link" href="#tag-attr-value-unquote-head"></a></h4>

  
    <dd>


     <p>Consume the next input character:</p>
     

      
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dd>Switch to the <a data-link-type="dfn" href="#tag-attribute-name-before-state">tag attribute name before state</a>.
      

      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>):
      
      <dd>
        Switch to <a data-link-type="dfn" href="#character-reference-in-attribute-value-state">character reference in attribute value state</a>, with the
        <a data-link-type="dfn" href="#additional-allowed-character">additional allowed character</a> being U+003E GREATER-THAN SIGN(<code>></code>).
      
      

      
      <dt>U+003E GREATER-THAN SIGN (<code>></code>)
      
      
      <dd>Emit the current token as start tag token and then switch to the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>EOF
      
      
      <dd><a data-link-type="dfn" href="#parse-error">Parse error</a>. Emit the current token as start tag token and
     then reprocess the current input character in the
      <a data-link-type="dfn" href="#data-state">data state</a>.
      

      
      <dt>Anything else
      
      
      <dd>Append the input character to the current attribute’s value. Stay in
     the current state.
      
    
     </dl>
     
  

  
    <h4 class="heading settled" data-level="1.3.28" id="charref-attr-head"><span class="secno">1.3.28. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="character-reference-in-attribute-value-state">Character reference in attribute value state<a class="self-link" href="#character-reference-in-attribute-value-state"></a></dfn></span><a class="self-link" href="#charref-attr-head"></a></h4>

  
    <dd>


     <p>Attempt to <a data-link-type="dfn" href="#consume-a-character-reference">consume a character reference</a>.</p>
     


     <p>If nothing is returned, append a U+0026 AMPERSAND (&amp;) character to current attribute’s value.</p>
     


     <p>Otherwise append returned character tokens to current attribute’s value.</p>
     


     <p>Finally, switch back to attribute value state that switched to this state.</p>
     
  


  
    <h4 class="heading settled" data-level="1.3.29" id="bogus-comment-head"><span class="secno">1.3.29. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="bogus-comment-state">Bogus comment state<a class="self-link" href="#bogus-comment-state"></a></dfn></span><a class="self-link" href="#bogus-comment-head"></a></h4>

  
    <dd>
  Consume every character up to the first U+003E GREATER-THAN SIGN (<code>></code>) or EOF, whichever comes first. Emit a comment token whose data is the concatenation of all those consumed characters. Then consume the next input character and switch to the <a data-link-type="dfn" href="#data-state">data state</a> reprocessing the EOF character if that was the character consumed.
   


  
    <h4 class="heading settled" data-level="1.3.30" id="charref-tokenizer-head"><span class="secno">1.3.30. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="tokenizing-character-references">Tokenizing character references<a class="self-link" href="#tokenizing-character-references"></a></dfn></span><a class="self-link" href="#charref-tokenizer-head"></a></h4>

  
    <dd>


     <p>This section defines how to <dfn data-dfn-type="dfn" data-noexport="" id="consume-a-character-reference">consume a character reference<a class="self-link" href="#consume-a-character-reference"></a></dfn>, optionally with an <dfn data-dfn-type="dfn" data-noexport="" id="additional-allowed-character">additional allowed character<a class="self-link" href="#additional-allowed-character"></a></dfn>, which, if specified where the algorithm is invoked, adds a character to the list of characters that cause there to not be a character reference.</p>
     


     <p>This definition is used when parsing character <a href="Data state">in text</a> and in <a href="Character reference in attribute value state">attributes</a>.</p>
     


     <p>The behavior depends on identity of next character (the one immediately after the U+0026 AMPERSAND character), as follows:</p>
     

    
     <dl class="switch">
      
      <dt>U+0009 CHARACTER TABULATION (<code class="non-print">Tab</code>)
      
      
      <dt>U+000A LINE FEED (<code class="non-print">LF</code>)
      
      
      <dt>U+000C FORM FEED (<code class="non-print">FF</code>)
      
      
      <dt>U+0020 SPACE (<code class="non-print">Space</code>)
      
      
      <dt>U+003C LESS-THAN SIGN (<code>&lt;</code>)
      
      
      <dt>U+0025 PERCENT SIGN (<code>%</code>)
      
      
      <dt>U+0026 AMPERSAND (<code>&amp;</code>)
      
      
      <dt>EOF
      
      
      <dt>The <a data-link-type="dfn" href="#additional-allowed-character">additional allowed character</a> if there is one
      
      
      <dd>Not a character reference. No characters are consumed and nothing is returned (This is not an error, either).
      
      
      <dt>U+0023 NUMBER SIGN (<code>#</code>)
      
      <dd>


       <p>Consume the U+0023 NUMBER SIGN.</p>
       


       <p>The behaviour further depends on the character after the U+0023 NUMBER SIGN.</p>
       

        
       <dl class="switch">
          
        <dt>U+0078 LATIN SMALL LETTER X
        
          
        <dt>U+0078 LATIN CAPITAL LETTER X
        
          
        <dd>
            
         <p>Consume the X.</p>
         
            
         <p>Follow the steps below, but using <a data-link-type="dfn" href="#ascii-hex-digits">ASCII hex digits</a>.</p>
         
            
         <p>When it comes to interpreting the number, interpret it as a hexadecimal number.</p>
         
          
        
          
        <dt>Anything else
        
          
        <dd>
            Follow the steps below, but using <a data-link-type="dfn" href="#ascii-digits">ASCII digits</a>.


         <p>When it comes to interpreting the number, interpret it as a decimal number.</p>
         
          
        
        
       </dl>
       


       <p>Consume as many characters as match the range of characters given above (<a data-link-type="dfn" href="#ascii-hex-digits">ASCII hex digits</a> or <a data-link-type="dfn" href="#ascii-digits">ASCII digits</a>).</p>
       


       <p>If no characters match the range, then don’t consume any characters. This is a <a data-link-type="dfn" href="#parse-error">parse error</a>; return the U+0023 NUMBER SIGN character and if appropriate X character as string of text.</p>
       


       <p>Otherwise, if the next character is a U+003B SEMICOLON, consume that too. If it isn’t, there is a <a data-link-type="dfn" href="#parse-error">parse error</a>.</p>
       


       <p>If one or more characters match the range, then take them all and interpret the string of characters as a number (either hexadecimal or decimal as appropriate).</p>
       

        
       <p class="warning">Should we do HTML like replacement? At least for null?</p>
       


       <p>Otherwise, if the number is in the range 0xD800 to 0xDFFF or is greater than 0x10FFFF, then this is a <a data-link-type="dfn" href="#parse-error">parse error</a>. Return a U+FFFD REPLACEMENT CHARACTER character token.</p>
       

        
       <div class="warning">Should we refuse Unicode from ranges listed (0x0001 to 0x0008, 0x000D to 0x001F, 0x007F to 0x009F, 0xFDD0 to 0xFDEF, or is one of 0x000B, 0xFFFE, 0xFFFF, 0x1FFFE, 0x1FFFF, 0x2FFFE, 0x2FFFF, 0x3FFFE, 0x3FFFF, 0x4FFFE, 0x4FFFF, 0x5FFFE, 0x5FFFF, 0x6FFFE, 0x6FFFF, 0x7FFFE, 0x7FFFF, 0x8FFFE, 0x8FFFF, 0x9FFFE, 0x9FFFF, 0xAFFFE, 0xAFFFF, 0xBFFFE, 0xBFFFF, 0xCFFFE, 0xCFFFF, 0xDFFFE, 0xDFFFF, 0xEFFFE, 0xEFFFF, 0xFFFFE, 0xFFFFF, 0x10FFFE, or 0x10FFFF)?<br>


        <p>I’ve noted that Javascript implementation of XML5 is having to go around some characters in its version.</p>
       </div>
       <p></p>
       
      
      
      
      <dt>Anything else
      
      
      <dd>


       <p>Consume characters until you reach a U+003B SEMICOLON character (<code>;</code>).</p>
       

        
       <p class="warning">What happens if there is no semicolon? Does it read rest of the file? Maybe better solution is to read all characters that are part of name char according to <a href="http://www.w3.org/TR/xml11/#NT-Name">XML 1.1. spec.</a></p>
       


       <p>Otherwise, a character reference is parsed. If the last character matched is not a U+003B SEMICOLON character (<code>;</code>), there is a <a data-link-type="dfn" href="#parse-error">parse error</a>.</p>
       


       <p>If there was a parse error the consumed characters are interperted as part of a string and are returned.</p>
       


       <p>If there wasn’t a parse error return a reference with name equal to consumed characters, omitting the U+003B SEMICOLON character (<code>;</code>).</p>
       

        
       <div class="example" id="example-787ee2b6"><a class="self-link" href="#example-787ee2b6"></a>
          If the markup contains following attribute <code>This is a &amp;ref;</code>, character tokenizer should return this as a reference named ref. However if the attribute defined is defined as <code>This is &amp;notref</code>, then the tokenizer will interpret this as a text <code>This is &amp;notref</code>, while emitting a parse error.
        </div>
       

      
      
    
     </dl>
     
  


  
    <h4 class="heading settled" data-level="1.3.31" id="doctype-head"><span class="secno">1.3.31. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="doctype-state">DOCTYPE state<a class="self-link" href="#doctype-state"></a></dfn></span><a class="self-link" href="#doctype-head"></a></h4>

  
    <p class="warning">TODO</p>
</dl>


   <h3 class="heading settled" data-level="1.4" id="tree-construction"><span class="secno">1.4. </span><span class="content">Tree construction</span><a class="self-link" href="#tree-construction"></a></h3>


   <p>The input to the tree construction stage is a sequence of tokens from the
  <a data-link-type="dfn" href="#tokenization">tokenization</a> stage. The output of this stage is a tree model
  represented by a <code>Document</code> object.</p>


   <p>The tree construction stage passes through several phases. The initial
  phase is the <a data-link-type="dfn" href="#start-phase">start phase</a>.</p>


   <p>The <dfn data-dfn-type="dfn" data-noexport="" id="stack-of-open-elements">stack of open elements<a class="self-link" href="#stack-of-open-elements"></a></dfn> contains all elements of which the
  closing tag has not yet been encountered. Once the first start tag token in
  the <a data-link-type="dfn" href="#start-phase">start phase</a> is encountered it will contain one open element.
  The rest of the elements are added during the <a data-link-type="dfn" href="#main-phase">main phase</a>.</p>


   <p>The <dfn data-dfn-type="dfn" data-noexport="" id="current-element">current element<a class="self-link" href="#current-element"></a></dfn> is the bottommost node in this stack.</p>


   <p>The <a data-link-type="dfn" href="#stack-of-open-elements">stack of open elements</a> is said to have an <dfn data-dfn-type="dfn" data-noexport="" id="element-in-scope">element in
  scope<a class="self-link" href="#element-in-scope"></a></dfn> if the target element is in the stack of open elements.</p>


   <p>When the steps below require the user agent to <dfn data-dfn-type="dfn" data-noexport="" id="append-a-character">append a
  character<a class="self-link" href="#append-a-character"></a></dfn> to a node, the user agent <em class="ct">must</em> collect it
  and all subsequent consecutive characters that would be appended to that node
  and insert one <code>Text</code> node whose data is the concatenation of all
  those characters.</p>


   <p><span class="warning">Need to define <dfn data-dfn-type="dfn" data-noexport="" id="create-an-element-for-the-token">create an element for the token<a class="self-link" href="#create-an-element-for-the-token"></a></dfn>...</span></p>


   <p>When the steps below require the user agent to <dfn data-dfn-type="dfn" data-noexport="" id="insert-an-element">insert an element<a class="self-link" href="#insert-an-element"></a></dfn>
  for a token the user agent <em class="ct">must</em> <a data-link-type="dfn" href="#create-an-element-for-the-token">create an element
  for the token</a> and then append it to the <a data-link-type="dfn" href="#current-element">current element</a>
  and push it into the <a data-link-type="dfn" href="#stack-of-open-elements">stack of open elements</a> so
  that it becomes the new <a data-link-type="dfn" href="#current-element">current element</a>.</p>


   <dl>


    <dt><dfn data-dfn-type="dfn" data-noexport="" id="start-phase">Start phase<a class="self-link" href="#start-phase"></a></dfn>


    <dd>
     <p>
  Each token emitted from the tokenization stage <em class="ct">must</em> be
  processed as follows until the algorithm below switches to a different
  phase:

</p>
     <dl class="switch">
  
      <dt>A start tag token
      
  
      <dd>


       <p><a data-link-type="dfn" href="#create-an-element-for-the-token">Create an element for the token</a> and then append it to the
    <code>Document</code> node and push it into the <a data-link-type="dfn" href="#stack-of-open-elements">stack of open elements</a>.</p>
       


       <p>This element is the root element and the first <a data-link-type="dfn" href="#current-element">current
    element</a>. Then switch to the <a data-link-type="dfn" href="#main-phase">main phase</a>.</p>
       
  
      

  
      <dt>An empty tag token
      
  
      <dd>


       <p><a data-link-type="dfn" href="#create-an-element-for-the-token">Create an element for the token</a> and append it to the
    <code>Document</code> node. Then switch to the <a data-link-type="dfn" href="#end-phase">end phase</a>.</p>
       

  
      

  
      <dt>A comment token
      
  
      <dd>


       <p>Append a <code>Comment</code> node to the <code>Document</code> node
    with the <code>data</code> attribute set to the data given in the
    token.</p>
       

  
      

  
      <dt>A processing instruction token
      
  
      <dd>


       <p>Append a <code>ProcessingInstruction</code> node to the
    <code>Document</code> node with the <code>target</code> and <code>data</code>
    atributes set to the target and data given in the token.</p>
       

  
      

  
      <dt>An end-of-file token
      
  
      <dd>


       <p><a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the token in the <a data-link-type="dfn" href="#end-phase">end
    phase</a>.</p>
       

  
      

  
      <dt>Anything else
      
  
      <dd>
    <a data-link-type="dfn" href="#parse-error">Parse error</a>. Ignore the token.
  
      

     </dl>


    <dt><dfn data-dfn-type="dfn" data-noexport="" id="main-phase">Main phase<a class="self-link" href="#main-phase"></a></dfn>


    <dd>
     <p>
Once a start tag token has been encountered (as detailed in the previous
phase) each token <em class="ct">must</em> be process using the following
steps until further notice:

</p>
     <dl class="switch">
  
      <dt>A character token
      
  
      <dd>


       <p><a data-link-type="dfn" href="#append-a-character">Append a character</a> to the <a data-link-type="dfn" href="#current-element">current
    element</a>.</p>
       

  
      

  
      <dt>A start tag token
      
  
      <dd>
       <p><a data-link-type="dfn" href="#insert-an-element">Insert an element</a> for the token.</p>
      

  
      <dt>An empty tag token
      
  
      <dd>
       <p><a data-link-type="dfn" href="#create-an-element-for-the-token">Create an element for the token</a> and append it to the
    <a data-link-type="dfn" href="#current-element">current element</a>.</p>
      

  
      <dt>An end tag token
      
  
      <dd>


       <p>If the tag name of the <a href="current element">current node</a> does not match the tag
    name of the end tag token this is a <a data-link-type="dfn" href="#parse-error">parse error</a>.</p>
       


       <p>If there is an <a data-link-type="dfn" href="#element-in-scope">element in scope</a> with the same tag name as
    that of the token pop nodes from the <a data-link-type="dfn" href="#stack-of-open-elements">stack of open elements</a>
    until the first such element has been popped from the stack.</p>
       


       <p>If there are no more elements on the stack of open elements at this point
    switch to the <a data-link-type="dfn" href="#end-phase">end phase</a>.</p>
       
  
      

  
      <dt>A short end tag token
      
  
      <dd>


       <p>Pop an element from the <a data-link-type="dfn" href="#stack-of-open-elements">stack of open elements</a>. If there
    are no more elements on the stack of open elements switch to the <a data-link-type="dfn" href="#end-phase">end
    phase</a>.</p>
       

  
      

  
      <dt>A comment token
      
  
      <dd>


       <p>Append a <code>Comment</code> node to the <a data-link-type="dfn" href="#current-element">current element</a>
    with the <code>data</code> attribute set to the data given in the
    token.</p>
       

  
      

  
      <dt>A processing instruction token
      
  
      <dd>
    Append a <code>ProcessingInstruction</code> node to the <a data-link-type="dfn" href="#current-element">current
    element</a> with the <code>target</code> and <code>data</code> atributes
    set to the target and data given in the token.

  
      

  
      <dt>An end-of-file token
      
  
      <dd>
    <a data-link-type="dfn" href="#parse-error">Parse error</a>. Reprocess the token in the <a data-link-type="dfn" href="#end-phase">end phase</a>.

  
      

     </dl>


    <dt><dfn data-dfn-type="dfn" data-noexport="" id="end-phase">End phase<a class="self-link" href="#end-phase"></a></dfn>

    <dd>
     <p>
  Tokens in end phase <em class="ct">must</em> be handled as follows:

</p>
     <dl class="switch">
  
      <dt>A comment token
      
  
      <dd>Append a <code>Comment</code> node to the <code>Document</code> node
    with the <code>data</code> attribute set to the data given in the
    token.
  
      

  
      <dt>A processing instruction token
      
  
      <dd>


       <p>Append a <code>ProcessingInstruction</code> node to the
    <code>Document</code> node with the <code>target</code> and <code>data</code>
    atributes set to the target and data given in the token.</p>
       

  
      

  
      <dt>An end-of-file token
      
  
      <dd>


       <p><a data-link-type="dfn" href="#stop-parsing">Stop parsing</a>.</p>
       
  
      

  
      <dt>Anything else
      
  
      <dd>


       <p><a data-link-type="dfn" href="#parse-error">Parse error</a>. Ignore the token.</p>
       
  
      

     </dl>

</dl>


   <p>Once the user agent <dfn data-dfn-type="dfn" data-lt="stop parsing" data-noexport="" id="stop-parsing">stops parsing<a class="self-link" href="#stop-parsing"></a></dfn> the
document, it <em class="ct">must</em> follow these steps:

</p>
   <p class="warning">TODO</p>


   <h2 class="heading settled" data-level="2" id="writing"><span class="secno">2. </span><span class="content">Writing XML documents</span><a class="self-link" href="#writing"></a></h2>


   <h2 class="heading settled" data-level="3" id="idioms"><span class="secno">3. </span><span class="content">Common parser idioms</span><a class="self-link" href="#idioms"></a></h2>


   <p>The <dfn data-dfn-type="dfn" data-noexport="" id="ascii-digits">ASCII digits<a class="self-link" href="#ascii-digits"></a></dfn> are the characters in the range U+0030 DIGIT ZERO (<code>0</code>) to U+0039 DIGIT NINE (<code>9</code>).</p>


   <p>The <dfn data-dfn-type="dfn" data-noexport="" id="ascii-hex-digits">ASCII hex digits<a class="self-link" href="#ascii-hex-digits"></a></dfn>  are the characters in the ranges U+0030 DIGIT ZERO (<code>0</code>) to U+0039 DIGIT NINE (<code>9</code>), U+0041 LATIN CAPITAL LETTER A to U+0046 LATIN CAPITAL LETTER F, and U+0061 LATIN SMALL LETTER A to U+0066 LATIN SMALL LETTER F.</p>

</main>
  

  <h2 class="no-num no-ref heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  


  <p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked
non-normative. Everything else in this specification is normative.

</p>
  <p>The key words "MUST", "MUST NOT", "REQUIRED",  "SHOULD", "SHOULD NOT", "RECOMMENDED",
"MAY", and "OPTIONAL" in the normative parts of this specification are to be interpreted as described in RFC2119. For
readability, these words do not appear in all uppercase letters in this specification. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a>

</p>
  <p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end
result is equivalent. (In particular, the algorithms defined in this specification are intended to be easy to follow, 
and not intended to be performant.) 
</p>
  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li>additional allowed character, <a href="#additional-allowed-character">1.3.30</a>
   <li>append a
  character, <a href="#append-a-character">1.4</a>
   <li>ASCII digits, <a href="#ascii-digits">3</a>
   <li>ASCII hex digits, <a href="#ascii-hex-digits">3</a>
   <li>Bogus comment state, <a href="#bogus-comment-state">1.3.29</a>
   <li>CDATA bracket state, <a href="#cdata-bracket-state">1.3.17</a>
   <li>CDATA end state, <a href="#cdata-end-state">1.3.18</a>
   <li>CDATA state, <a href="#cdata-state">1.3.16</a>
   <li>Character reference in attribute value state, <a href="#character-reference-in-attribute-value-state">1.3.28</a>
   <li>Character reference in data state, <a href="#character-reference-in-data-state">1.3.2</a>
   <li>Comment dash state, <a href="#comment-dash-state">1.3.14</a>
   <li>Comment end state, <a href="#comment-end-state">1.3.15</a>
   <li>Comment state, <a href="#comment-state">1.3.13</a>
   <li>consume a character reference, <a href="#consume-a-character-reference">1.3.30</a>
   <li>create an element for the token, <a href="#create-an-element-for-the-token">1.4</a>
   <li>current element, <a href="#current-element">1.4</a>
   <li>Data state, <a href="#data-state">1.3.1</a>
   <li>DOCTYPE state, <a href="#doctype-state">1.3.31</a>
   <li>element in
  scope, <a href="#element-in-scope">1.4</a>
   <li>Empty tag state, <a href="#empty-tag-state">1.3.20</a>
   <li>End phase, <a href="#end-phase">1.4</a>
   <li>End tag name after state, <a href="#end-tag-name-after-state">1.3.6</a>
   <li>End tag name state, <a href="#end-tag-name-state">1.3.5</a>
   <li>End tag state, <a href="#end-tag-state">1.3.4</a>
   <li>insert an element, <a href="#insert-an-element">1.4</a>
   <li>Main phase, <a href="#main-phase">1.4</a>
   <li>Markup declaration state, <a href="#markup-declaration-state">1.3.12</a>
   <li>parse error, <a href="#parse-error">1</a>
   <li>Pi after state, <a href="#pi-after-state">1.3.11</a>
   <li>Pi data state, <a href="#pi-data-state">1.3.10</a>
   <li>Pi state, <a href="#pi-state">1.3.7</a>
   <li>Pi target after state, <a href="#pi-target-after-state">1.3.9</a>
   <li>Pi target state, <a href="#pi-target-state">1.3.8</a>
   <li>stack of open elements, <a href="#stack-of-open-elements">1.4</a>
   <li>Start phase, <a href="#start-phase">1.4</a>
   <li>stop parsing, <a href="#stop-parsing">1.4</a>
   <li>Tag attribute name after state, <a href="#tag-attribute-name-after-state">1.3.23</a>
   <li>Tag attribute name before state, <a href="#tag-attribute-name-before-state">1.3.21</a>
   <li>Tag attribute name state, <a href="#tag-attribute-name-state">1.3.22</a>
   <li>Tag attribute value before state, <a href="#tag-attribute-value-before-state">1.3.24</a>
   <li>Tag attribute value double quoted state, <a href="#tag-attribute-value-double-quoted-state">1.3.25</a>
   <li>Tag attribute value single quoted state, <a href="#tag-attribute-value-single-quoted-state">1.3.26</a>
   <li>Tag attribute value unquoted state, <a href="#tag-attribute-value-unquoted-state">1.3.27</a>
   <li>Tag name state, <a href="#tag-name-state">1.3.19</a>
   <li>Tag state, <a href="#tag-state">1.3.3</a>
   <li>Tokenization, <a href="#tokenization">1.3</a>
   <li>Tokenizing character references, <a href="#tokenizing-character-references">1.3.30</a>
   <li>XML parser, <a href="#xml-parser">1</a></ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a></dl>
 </body>
</html>